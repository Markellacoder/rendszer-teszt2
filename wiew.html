<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Távoli Monitor</title>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; display: flex; flex-direction: column; align-items: center; }
        video { width: 100vw; height: auto; max-height: 90vh; background: #111; }
        .controls { padding: 10px; background: #222; width: 100%; text-align: center; color: white; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="controls">
        <button onclick="location.reload()">ÚJRACSATLAKOZÁS</button>
        <span id="status" style="margin-left: 10px;">Csatlakozás...</span>
    </div>
    <video id="remoteVideo" autoplay playsinline></video>

    <script>
        const videoElem = document.getElementById('remoteVideo');
        const status = document.getElementById('status');
        
        const peer = new Peer(); 
        const TARGET_ID = 'markella_stabil_2026_final'; 

        peer.on('open', () => {
            status.innerText = "Szerver OK, keresem a PC-t...";
            
            // 2 másodpercet várunk, hogy a szerver biztosan regisztráljon minket
            setTimeout(() => {
                const call = peer.call(TARGET_ID, new MediaStream());
                
                call.on('stream', remoteStream => {
                    videoElem.srcObject = remoteStream;
                    status.innerText = "ÉLŐ ADÁS";
                });

                // Ha 5 mp után sincs kép, kiírjuk a tippet
                setTimeout(() => {
                    if (status.innerText !== "ÉLŐ ADÁS") {
                        status.innerText = "Nincs válasz a PC-től. Indítsd el a START-ot a PC-n!";
                    }
                }, 5000);
            }, 2000);
        });

        peer.on('error', err => {
            status.innerText = "Kapcsolati hiba történt.";
            console.error(err);
        });
    </script>
</body>
</html>
